{"stages": ["push-to-github", "schedule1", "schedule2", "deploy", "deploy test", "deploy validate", "docker build and deploy", "docker deploy validate"], "image": "sikalabs/ci-node", "variables": {"DOCKER_BUILDKIT": "1", "GIT_CLEAN_FLAGS": "-ffdx -e node_modules -e .yarn-cache"}, "push-to-github": {"image": "sikalabs/ci", "stage": "push-to-github", "script": ["mkdir -p ~/.ssh", "cp $GITHUB_PUSH_SSH_KEY_PRIV ~/.ssh/id_rsa", "chmod 700 -R ~/.ssh", "ssh-keyscan github.com >> ~/.ssh/known_hosts", "git remote add github-$CI_PIPELINE_ID git@github.com:ondrejsika/www.git", "git push github-$CI_PIPELINE_ID $CI_COMMIT_SHA:$CI_COMMIT_BRANCH -f"]}, "auto_update_sessions_yml_from_training_crm": {"stage": "schedule1", "image": "sikalabs/ci", "variables": {"GIT_AUTHOR_NAME": "SikaLabs CI Bot", "GIT_COMMITTER_NAME": "SikaLabs CI Bot", "GIT_COMMITTER_EMAIL": "ci-bot@sikalabs.io", "GIT_AUTHOR_EMAIL": "ci-bot@sikalabs.io"}, "script": ["make auto-update-sessions-yml-from-training-crm", "git remote set-url origin https://ci-bot:$GITLAB_TOKEN_CI_BOT@$CI_SERVER_HOST/$CI_PROJECT_PATH.git", "git push origin HEAD:$CI_COMMIT_BRANCH"], "only": ["schedule"]}, "auto_ncu_update": {"stage": "schedule2", "image": "sikalabs/ci-node", "variables": {"GIT_AUTHOR_NAME": "SikaLabs CI Bot", "GIT_COMMITTER_NAME": "SikaLabs CI Bot", "GIT_COMMITTER_EMAIL": "ci-bot@sikalabs.io", "GIT_AUTHOR_EMAIL": "ci-bot@sikalabs.io"}, "script": ["yarn", "make auto-ncu-update", "cd sites20 && make auto-ncu-update", "git remote set-url origin https://ci-bot:$GITLAB_TOKEN_CI_BOT@$CI_SERVER_HOST/$CI_PROJECT_PATH.git", "git push origin HEAD:$CI_COMMIT_BRANCH"], "only": ["schedule"]}, "deploy trainera.de": {"stage": "deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/trainera.de/out", "mkdir -p packages/trainera.de/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/trainera.de/public/api/version.json", "yarn --cache-folder .yarn-cache add @cloudflare/wrangler -W", "yarn run deploy-trainera.de"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/trainera.de/**/*", "yarn.lock"]}, "needs": []}, "validate trainera.de": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://trainera.de/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/trainera.de/**/*", "yarn.lock"]}, "needs": ["deploy trainera.de"]}, "deploy ondrej-sika.com": {"stage": "deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/ondrej-sika.com/out", "mkdir -p packages/ondrej-sika.com/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/ondrej-sika.com/public/api/version.json", "yarn --cache-folder .yarn-cache add @cloudflare/wrangler -W", "yarn run deploy-ondrej-sika.com"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/ondrej-sika.com/**/*", "yarn.lock"]}, "needs": []}, "validate ondrej-sika.com": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://ondrej-sika.com/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/ondrej-sika.com/**/*", "yarn.lock"]}, "needs": ["deploy ondrej-sika.com"]}, "deploy ondrej-sika.cz": {"stage": "deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/ondrej-sika.cz/out", "mkdir -p packages/ondrej-sika.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/ondrej-sika.cz/public/api/version.json", "yarn --cache-folder .yarn-cache add @cloudflare/wrangler -W", "yarn run deploy-ondrej-sika.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/ondrej-sika.cz/**/*", "yarn.lock"]}, "needs": []}, "validate ondrej-sika.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://ondrej-sika.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/ondrej-sika.cz/**/*", "yarn.lock"]}, "needs": ["deploy ondrej-sika.cz"]}, "deploy ondrej-sika.de": {"stage": "deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/ondrej-sika.de/out", "mkdir -p packages/ondrej-sika.de/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/ondrej-sika.de/public/api/version.json", "yarn --cache-folder .yarn-cache add @cloudflare/wrangler -W", "yarn run deploy-ondrej-sika.de"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/ondrej-sika.de/**/*", "yarn.lock", "packages/ondrejsika-singlepage/**/*"]}, "needs": []}, "validate ondrej-sika.de": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://ondrej-sika.de/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/ondrej-sika.de/**/*", "yarn.lock", "packages/ondrejsika-singlepage/**/*"]}, "needs": ["deploy ondrej-sika.de"]}, "deploy ondrejsika.is": {"stage": "deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/ondrejsika.is/out", "mkdir -p packages/ondrejsika.is/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/ondrejsika.is/public/api/version.json", "yarn --cache-folder .yarn-cache add @cloudflare/wrangler -W", "yarn run deploy-ondrejsika.is"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/ondrejsika.is/**/*", "yarn.lock", "packages/ondrejsika-singlepage/**/*"]}, "needs": []}, "validate ondrejsika.is": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://ondrejsika.is/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/ondrejsika.is/**/*", "yarn.lock", "packages/ondrejsika-singlepage/**/*"]}, "needs": ["deploy ondrejsika.is"]}, "deploy trainera.cz": {"stage": "deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/trainera.cz/out", "mkdir -p packages/trainera.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/trainera.cz/public/api/version.json", "yarn --cache-folder .yarn-cache add @cloudflare/wrangler -W", "yarn run deploy-trainera.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/trainera.cz/**/*", "yarn.lock"]}, "needs": []}, "validate trainera.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://trainera.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/ondrejsika-theme/**/*", "packages/trainera.cz/**/*", "yarn.lock"]}, "needs": ["deploy trainera.cz"]}, "deploy skoleni.io": {"stage": "deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/skoleni.io/out", "mkdir -p packages/skoleni.io/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/skoleni.io/public/api/version.json", "yarn --cache-folder .yarn-cache add @cloudflare/wrangler -W", "yarn run deploy-skoleni.io"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni.io/**/*", "yarn.lock"]}, "needs": []}, "validate skoleni.io": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://skoleni.io/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni.io/**/*", "yarn.lock"]}, "needs": ["deploy skoleni.io"]}, "deploy skoleni-git.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/skoleni-git.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/skoleni-git.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/skoleni-git.cz/public/api/version.json", "yarn run deploy-skoleni-git.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-git.cz/**/*", "yarn.lock"]}, "needs": []}, "validate skoleni-git.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://skoleni-git.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-git.cz/**/*", "yarn.lock"]}, "needs": ["deploy skoleni-git.cz"]}, "deploy skoleni-docker.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/skoleni-docker.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/skoleni-docker.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/skoleni-docker.cz/public/api/version.json", "yarn run deploy-skoleni-docker.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-docker.cz/**/*", "yarn.lock"]}, "needs": []}, "validate skoleni-docker.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://skoleni-docker.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-docker.cz/**/*", "yarn.lock"]}, "needs": ["deploy skoleni-docker.cz"]}, "deploy skoleni-kubernetes.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/skoleni-kubernetes.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/skoleni-kubernetes.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/skoleni-kubernetes.cz/public/api/version.json", "yarn run deploy-skoleni-kubernetes.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-kubernetes.cz/**/*", "yarn.lock"]}, "needs": []}, "validate skoleni-kubernetes.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://skoleni-kubernetes.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-kubernetes.cz/**/*", "yarn.lock"]}, "needs": ["deploy skoleni-kubernetes.cz"]}, "deploy skoleni-proxmox.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/skoleni-proxmox.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/skoleni-proxmox.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/skoleni-proxmox.cz/public/api/version.json", "yarn run deploy-skoleni-proxmox.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-proxmox.cz/**/*", "yarn.lock"]}, "needs": []}, "validate skoleni-proxmox.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://skoleni-proxmox.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-proxmox.cz/**/*", "yarn.lock"]}, "needs": ["deploy skoleni-proxmox.cz"]}, "deploy skoleni-prometheus.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/skoleni-prometheus.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/skoleni-prometheus.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/skoleni-prometheus.cz/public/api/version.json", "yarn run deploy-skoleni-prometheus.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-prometheus.cz/**/*", "yarn.lock"]}, "needs": []}, "validate skoleni-prometheus.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://skoleni-prometheus.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-prometheus.cz/**/*", "yarn.lock"]}, "needs": ["deploy skoleni-prometheus.cz"]}, "deploy skoleni-terraform.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/skoleni-terraform.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/skoleni-terraform.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/skoleni-terraform.cz/public/api/version.json", "yarn run deploy-skoleni-terraform.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-terraform.cz/**/*", "yarn.lock"]}, "needs": []}, "validate skoleni-terraform.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://skoleni-terraform.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-terraform.cz/**/*", "yarn.lock"]}, "needs": ["deploy skoleni-terraform.cz"]}, "deploy skoleni-rancher.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/skoleni-rancher.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/skoleni-rancher.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/skoleni-rancher.cz/public/api/version.json", "yarn run deploy-skoleni-rancher.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-rancher.cz/**/*", "yarn.lock"]}, "needs": []}, "validate skoleni-rancher.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://skoleni-rancher.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni-rancher.cz/**/*", "yarn.lock"]}, "needs": ["deploy skoleni-rancher.cz"]}, "deploy gitlab-ci.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/gitlab-ci.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/gitlab-ci.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/gitlab-ci.cz/public/api/version.json", "yarn run deploy-gitlab-ci.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/gitlab-ci.cz/**/*", "yarn.lock"]}, "needs": []}, "validate gitlab-ci.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://gitlab-ci.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/gitlab-ci.cz/**/*", "yarn.lock"]}, "needs": ["deploy gitlab-ci.cz"]}, "deploy ansible-skoleni.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/ansible-skoleni.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/ansible-skoleni.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/ansible-skoleni.cz/public/api/version.json", "yarn run deploy-ansible-skoleni.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/ansible-skoleni.cz/**/*", "yarn.lock"]}, "needs": []}, "validate ansible-skoleni.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://ansible-skoleni.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/ansible-skoleni.cz/**/*", "yarn.lock"]}, "needs": ["deploy ansible-skoleni.cz"]}, "deploy skoleni.digitalocean.cz": {"stage": "deploy", "script": ["rm -rf ./sites20/sites/skoleni.digitalocean.cz/out", "yarn --cache-folder .yarn-cache", "mkdir -p packages/skoleni.digitalocean.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME  -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/skoleni.digitalocean.cz/public/api/version.json", "yarn run deploy-skoleni.digitalocean.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni.digitalocean.cz/**/*", "yarn.lock"]}, "needs": []}, "validate skoleni.digitalocean.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://skoleni.digitalocean.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni.digitalocean.cz/**/*", "yarn.lock"]}, "needs": ["deploy skoleni.digitalocean.cz"]}, "deploy test ondrejsika.io": {"stage": "deploy test", "script": ["rm -rf ./packages/ondrejsika.io/out", "yarn  --cache-folder .yarn-cache", "mkdir -p packages/ondrejsika.io/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/ondrejsika.io/public/api/version.json", "yarn run static-ondrejsika.io", "statica test-ondrejsika-io-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN ./packages/ondrejsika.io/out"], "only": {"changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/ondrejsika.io/**/*", "yarn.lock"]}, "needs": [], "environment": {"name": "test ondrejsika.io", "url": "https://test-ondrejsika-io-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN"}}, "deploy test skoleni.io": {"stage": "deploy test", "script": ["rm -rf ./packages/skoleni.io/out", "yarn  --cache-folder .yarn-cache", "mkdir -p packages/skoleni.io/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/skoleni.io/public/api/version.json", "yarn run static-skoleni.io", "statica test-skoleni-io-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN ./packages/skoleni.io/out"], "only": {"changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skoleni.io/**/*", "yarn.lock"]}, "needs": [], "environment": {"name": "test skoleni.io", "url": "https://test-skoleni-io-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN"}}, "deploy test ondrej-sika.cz": {"stage": "deploy test", "script": ["rm -rf ./packages/ondrej-sika.cz/out", "yarn  --cache-folder .yarn-cache", "mkdir -p packages/ondrej-sika.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/ondrej-sika.cz/public/api/version.json", "yarn run static-ondrej-sika.cz", "statica test-ondrej-sika-cz-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN ./packages/ondrej-sika.cz/out"], "only": {"changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/ondrej-sika.cz/**/*", "yarn.lock"]}, "needs": [], "environment": {"name": "test ondrej-sika.cz", "url": "https://test-ondrej-sika-cz-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN"}}, "deploy test sikalabs.com": {"stage": "deploy test", "script": ["rm -rf ./packages/sikalabs.com/out", "yarn  --cache-folder .yarn-cache", "mkdir -p packages/sikalabs.com/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/sikalabs.com/public/api/version.json", "yarn run static-sikalabs.com", "statica test-sikalabs-com-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN ./packages/sikalabs.com/out"], "only": {"changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/sikalabs.com/**/*", "yarn.lock"]}, "needs": [], "environment": {"name": "test sikalabs.com", "url": "https://test-sikalabs-com-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN"}}, "deploy test ondrej-sika.uk": {"stage": "deploy test", "script": ["rm -rf ./packages/ondrej-sika.uk/out", "yarn  --cache-folder .yarn-cache", "mkdir -p packages/ondrej-sika.uk/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > packages/ondrej-sika.uk/public/api/version.json", "yarn run static-ondrej-sika.uk", "statica test-ondrej-sika-uk-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN ./packages/ondrej-sika.uk/out"], "only": {"changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/ondrej-sika.uk/**/*", "yarn.lock"]}, "needs": [], "environment": {"name": "test ondrej-sika.uk", "url": "https://test-ondrej-sika-uk-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN"}}, "deploy sites20 digitalocean.cz": {"stage": "deploy", "script": ["mkdir -p sites20/sites/digitalocean.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > sites20/sites/digitalocean.cz/public/api/version.json", "cd sites20", "rm -rf ./sites/digitalocean.cz/out", "yarn --cache-folder .yarn-cache", "yarn run deploy-digitalocean.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/digitalocean.cz/**/*", "sites20/yarn.lock"]}, "needs": []}, "validate digitalocean.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://digitalocean.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/digitalocean.cz/**/*", "sites20/yarn.lock"]}, "needs": ["deploy sites20 digitalocean.cz"]}, "deploy sites20 devopsnews.cz": {"stage": "deploy", "script": ["mkdir -p sites20/sites/devopsnews.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > sites20/sites/devopsnews.cz/public/api/version.json", "cd sites20", "rm -rf ./sites/devopsnews.cz/out", "yarn --cache-folder .yarn-cache", "yarn run deploy-devopsnews.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/devopsnews.cz/**/*", "sites20/yarn.lock"]}, "needs": []}, "validate devopsnews.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://devopsnews.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/devopsnews.cz/**/*", "sites20/yarn.lock"]}, "needs": ["deploy sites20 devopsnews.cz"]}, "deploy sites20 hashicorp.cz": {"stage": "deploy", "script": ["mkdir -p sites20/sites/hashicorp.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > sites20/sites/hashicorp.cz/public/api/version.json", "cd sites20", "rm -rf ./sites/hashicorp.cz/out", "yarn --cache-folder .yarn-cache", "yarn run deploy-hashicorp.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/hashicorp.cz/**/*", "sites20/yarn.lock"]}, "needs": []}, "validate hashicorp.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://hashicorp.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/hashicorp.cz/**/*", "sites20/yarn.lock"]}, "needs": ["deploy sites20 hashicorp.cz"]}, "deploy sites20 devopsaci-landing": {"stage": "deploy", "script": ["mkdir -p sites20/sites/devopsaci-landing/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > sites20/sites/devopsaci-landing/public/api/version.json", "cd sites20", "rm -rf ./sites/devopsaci-landing/out", "yarn --cache-folder .yarn-cache", "yarn run deploy-devopsaci-landing"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/devopsaci-landing/**/*", "sites20/yarn.lock"]}, "needs": []}, "validate devopsaci-landing": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://devopsaci.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/devopsaci-landing/**/*", "sites20/yarn.lock"]}, "needs": ["deploy sites20 devopsaci-landing"]}, "deploy sites20 sikahosting.com": {"stage": "deploy", "script": ["mkdir -p sites20/sites/sikahosting.com/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > sites20/sites/sikahosting.com/public/api/version.json", "cd sites20", "rm -rf ./sites/sikahosting.com/out", "yarn --cache-folder .yarn-cache", "yarn run deploy-sikahosting.com"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/sikahosting.com/**/*", "sites20/yarn.lock"]}, "needs": []}, "validate sikahosting.com": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://sikahosting.com/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["sites20/sites/sikahosting.com/**/*", "sites20/yarn.lock"]}, "needs": ["deploy sites20 sikahosting.com"]}, "deploy dev sites20 devopsaci-landing": {"stage": "deploy test", "script": ["mkdir -p sites20/sites/devopsaci-landing/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > sites20/sites/devopsaci-landing/public/api/version.json", "cd sites20", "rm -rf ./sites/devopsaci-landing/out", "yarn --cache-folder .yarn-cache", "yarn static-devopsaci-landing", "statica test-devopsaci-landing-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN ./sites/devopsaci-landing/out"], "only": {"changes": ["sites20/sites/devopsaci-landing/**/*", "sites20/yarn.lock"]}, "needs": []}, "validate dev devopsaci-landing": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://test-devopsaci-landing-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"changes": ["sites20/sites/devopsaci-landing/**/*", "sites20/yarn.lock"]}, "needs": ["deploy dev sites20 devopsaci-landing"]}, "deploy dev sites20 sikalabs-landing": {"stage": "deploy test", "script": ["mkdir -p sites20/sites/sikalabs-landing/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > sites20/sites/sikalabs-landing/public/api/version.json", "cd sites20", "rm -rf ./sites/sikalabs-landing/out", "yarn --cache-folder .yarn-cache", "yarn static-sikalabs-landing", "statica test-sikalabs-landing-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN ./sites/sikalabs-landing/out"], "only": {"changes": ["sites20/sites/sikalabs-landing/**/*", "sites20/yarn.lock"]}, "needs": []}, "validate dev sikalabs-landing": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://test-sikalabs-landing-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"changes": ["sites20/sites/sikalabs-landing/**/*", "sites20/yarn.lock"]}, "needs": ["deploy dev sites20 sikalabs-landing"]}, "deploy dev sites20 devopsaci.cz": {"stage": "deploy test", "script": ["mkdir -p sites20/sites/devopsaci.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\" > sites20/sites/devopsaci.cz/public/api/version.json", "cd sites20", "rm -rf ./sites/devopsaci.cz/out", "yarn --cache-folder .yarn-cache", "yarn static-devopsaci.cz", "statica test-devopsaci-cz-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN ./sites/devopsaci.cz/out"], "only": {"changes": ["sites20/sites/devopsaci.cz/**/*", "sites20/yarn.lock"]}, "needs": []}, "validate dev devopsaci.cz": {"stage": "deploy validate", "script": ["COMMIT=$(curl -fsSL https://test-devopsaci-cz-$CI_COMMIT_REF_SLUG.$STATICA_BASE_DOMAIN/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"changes": ["sites20/sites/devopsaci.cz/**/*", "sites20/yarn.lock"]}, "needs": ["deploy dev sites20 devopsaci.cz"]}, "deploy skolenie.kubernetes.sk": {"stage": "docker build and deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/skolenie.kubernetes.sk/out", "mkdir -p packages/skolenie.kubernetes.sk/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/skolenie.kubernetes.sk/public/api/version.json", "yarn run static-skolenie.kubernetes.sk", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "cp ci/docker/* packages/skolenie.kubernetes.sk/", "docker build --platform linux/amd64 -t $CI_REGISTRY_IMAGE/skolenie.kubernetes.sk:$CI_COMMIT_SHORT_SHA packages/skolenie.kubernetes.sk", "rm packages/skolenie.kubernetes.sk/Dockerfile", "rm packages/skolenie.kubernetes.sk/nginx-site.conf", "docker push $CI_REGISTRY_IMAGE/skolenie.kubernetes.sk:$CI_COMMIT_SHORT_SHA", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "docker pull $CI_REGISTRY_IMAGE/skolenie.kubernetes.sk:$CI_COMMIT_SHORT_SHA", "docker tag $CI_REGISTRY_IMAGE/skolenie.kubernetes.sk:$CI_COMMIT_SHORT_SHA $CI_REGISTRY_IMAGE/skolenie.kubernetes.sk", "docker push $CI_REGISTRY_IMAGE/skolenie.kubernetes.sk"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skolenie.kubernetes.sk/**/*", "yarn.lock"]}, "needs": []}, "validate skolenie.kubernetes.sk": {"stage": "docker deploy validate", "script": ["COMMIT=$(curl -fsSL https://skolenie.kubernetes.sk/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/skolenie.kubernetes.sk/**/*", "yarn.lock"]}, "needs": ["deploy skolenie.kubernetes.sk"]}, "deploy training.kubernetes.is": {"stage": "docker build and deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/training.kubernetes.is/out", "mkdir -p packages/training.kubernetes.is/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/training.kubernetes.is/public/api/version.json", "yarn run static-training.kubernetes.is", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "cp ci/docker/* packages/training.kubernetes.is/", "docker build --platform linux/amd64 -t $CI_REGISTRY_IMAGE/training.kubernetes.is:$CI_COMMIT_SHORT_SHA packages/training.kubernetes.is", "rm packages/training.kubernetes.is/Dockerfile", "rm packages/training.kubernetes.is/nginx-site.conf", "docker push $CI_REGISTRY_IMAGE/training.kubernetes.is:$CI_COMMIT_SHORT_SHA", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "docker pull $CI_REGISTRY_IMAGE/training.kubernetes.is:$CI_COMMIT_SHORT_SHA", "docker tag $CI_REGISTRY_IMAGE/training.kubernetes.is:$CI_COMMIT_SHORT_SHA $CI_REGISTRY_IMAGE/training.kubernetes.is", "docker push $CI_REGISTRY_IMAGE/training.kubernetes.is"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/training.kubernetes.is/**/*", "yarn.lock"]}, "needs": []}, "validate training.kubernetes.is": {"stage": "docker deploy validate", "script": ["COMMIT=$(curl -fsSL https://training.kubernetes.is/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/training.kubernetes.is/**/*", "yarn.lock"]}, "needs": ["deploy training.kubernetes.is"]}, "deploy training.kubernetes.lu": {"stage": "docker build and deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/training.kubernetes.lu/out", "mkdir -p packages/training.kubernetes.lu/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/training.kubernetes.lu/public/api/version.json", "yarn run static-training.kubernetes.lu", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "cp ci/docker/* packages/training.kubernetes.lu/", "docker build --platform linux/amd64 -t $CI_REGISTRY_IMAGE/training.kubernetes.lu:$CI_COMMIT_SHORT_SHA packages/training.kubernetes.lu", "rm packages/training.kubernetes.lu/Dockerfile", "rm packages/training.kubernetes.lu/nginx-site.conf", "docker push $CI_REGISTRY_IMAGE/training.kubernetes.lu:$CI_COMMIT_SHORT_SHA", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "docker pull $CI_REGISTRY_IMAGE/training.kubernetes.lu:$CI_COMMIT_SHORT_SHA", "docker tag $CI_REGISTRY_IMAGE/training.kubernetes.lu:$CI_COMMIT_SHORT_SHA $CI_REGISTRY_IMAGE/training.kubernetes.lu", "docker push $CI_REGISTRY_IMAGE/training.kubernetes.lu"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/training.kubernetes.lu/**/*", "yarn.lock"]}, "needs": []}, "validate training.kubernetes.lu": {"stage": "docker deploy validate", "script": ["COMMIT=$(curl -fsSL https://training.kubernetes.lu/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/training/sessions.yml", "packages/data/training/recommendations/**/*", "packages/data/training/recommendations/**/*", "packages/data/training/pictures/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/training.kubernetes.lu/**/*", "yarn.lock"]}, "needs": ["deploy training.kubernetes.lu"]}, "deploy cal-api.sika.io": {"stage": "docker build and deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/cal-api.sika.io/out", "mkdir -p packages/cal-api.sika.io/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/cal-api.sika.io/public/api/version.json", "yarn run static-cal-api.sika.io", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "cp ci/docker/* packages/cal-api.sika.io/", "docker build --platform linux/amd64 -t $CI_REGISTRY_IMAGE/cal-api.sika.io:$CI_COMMIT_SHORT_SHA packages/cal-api.sika.io", "rm packages/cal-api.sika.io/Dockerfile", "rm packages/cal-api.sika.io/nginx-site.conf", "docker push $CI_REGISTRY_IMAGE/cal-api.sika.io:$CI_COMMIT_SHORT_SHA", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "docker pull $CI_REGISTRY_IMAGE/cal-api.sika.io:$CI_COMMIT_SHORT_SHA", "docker tag $CI_REGISTRY_IMAGE/cal-api.sika.io:$CI_COMMIT_SHORT_SHA $CI_REGISTRY_IMAGE/cal-api.sika.io", "docker push $CI_REGISTRY_IMAGE/cal-api.sika.io"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/cal-api.sika.io/**/*", "yarn.lock"]}, "needs": []}, "validate cal-api.sika.io": {"stage": "docker deploy validate", "script": ["COMMIT=$(curl -fsSL https://cal-api.sika.io/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/cal-api.sika.io/**/*", "yarn.lock"]}, "needs": ["deploy cal-api.sika.io"]}, "deploy ccc.oxs.cz": {"stage": "docker build and deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/ccc.oxs.cz/out", "mkdir -p packages/ccc.oxs.cz/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/ccc.oxs.cz/public/api/version.json", "yarn run static-ccc.oxs.cz", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "cp ci/docker/* packages/ccc.oxs.cz/", "docker build --platform linux/amd64 -t $CI_REGISTRY_IMAGE/ccc.oxs.cz:$CI_COMMIT_SHORT_SHA packages/ccc.oxs.cz", "rm packages/ccc.oxs.cz/Dockerfile", "rm packages/ccc.oxs.cz/nginx-site.conf", "docker push $CI_REGISTRY_IMAGE/ccc.oxs.cz:$CI_COMMIT_SHORT_SHA", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "docker pull $CI_REGISTRY_IMAGE/ccc.oxs.cz:$CI_COMMIT_SHORT_SHA", "docker tag $CI_REGISTRY_IMAGE/ccc.oxs.cz:$CI_COMMIT_SHORT_SHA $CI_REGISTRY_IMAGE/ccc.oxs.cz", "docker push $CI_REGISTRY_IMAGE/ccc.oxs.cz"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/ccc.oxs.cz/**/*", "yarn.lock"]}, "needs": []}, "validate ccc.oxs.cz": {"stage": "docker deploy validate", "script": ["COMMIT=$(curl -fsSL https://ccc.oxs.cz/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/ccc.oxs.cz/**/*", "yarn.lock"]}, "needs": ["deploy ccc.oxs.cz"]}, "deploy sika.blog": {"stage": "docker build and deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/sika.blog/out", "mkdir -p packages/sika.blog/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/sika.blog/public/api/version.json", "yarn run static-sika.blog", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "cp ci/docker/* packages/sika.blog/", "docker build --platform linux/amd64 -t $CI_REGISTRY_IMAGE/sika.blog:$CI_COMMIT_SHORT_SHA packages/sika.blog", "rm packages/sika.blog/Dockerfile", "rm packages/sika.blog/nginx-site.conf", "docker push $CI_REGISTRY_IMAGE/sika.blog:$CI_COMMIT_SHORT_SHA", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "docker pull $CI_REGISTRY_IMAGE/sika.blog:$CI_COMMIT_SHORT_SHA", "docker tag $CI_REGISTRY_IMAGE/sika.blog:$CI_COMMIT_SHORT_SHA $CI_REGISTRY_IMAGE/sika.blog", "docker push $CI_REGISTRY_IMAGE/sika.blog"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/sika.blog/**/*", "yarn.lock"]}, "needs": []}, "validate sika.blog": {"stage": "docker deploy validate", "script": ["COMMIT=$(curl -fsSL https://sika.blog/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/sika.blog/**/*", "yarn.lock"]}, "needs": ["deploy sika.blog"]}, "deploy static.sika.io": {"stage": "docker build and deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/static.sika.io/out", "mkdir -p packages/static.sika.io/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/static.sika.io/public/api/version.json", "yarn run static-static.sika.io", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "cp ci/docker/* packages/static.sika.io/", "docker build --platform linux/amd64 -t $CI_REGISTRY_IMAGE/static.sika.io:$CI_COMMIT_SHORT_SHA packages/static.sika.io", "rm packages/static.sika.io/Dockerfile", "rm packages/static.sika.io/nginx-site.conf", "docker push $CI_REGISTRY_IMAGE/static.sika.io:$CI_COMMIT_SHORT_SHA", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "docker pull $CI_REGISTRY_IMAGE/static.sika.io:$CI_COMMIT_SHORT_SHA", "docker tag $CI_REGISTRY_IMAGE/static.sika.io:$CI_COMMIT_SHORT_SHA $CI_REGISTRY_IMAGE/static.sika.io", "docker push $CI_REGISTRY_IMAGE/static.sika.io"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/static.sika.io/**/*", "yarn.lock"]}, "needs": []}, "validate static.sika.io": {"stage": "docker deploy validate", "script": ["COMMIT=$(curl -fsSL https://static.sika.io/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/static.sika.io/**/*", "yarn.lock"]}, "needs": ["deploy static.sika.io"]}, "deploy sikahq.com": {"stage": "docker build and deploy", "script": ["yarn --cache-folder .yarn-cache", "rm -rf packages/sikahq.com/out", "mkdir -p packages/sikahq.com/public/api", "slu static-api version --set-git-clean --set-git-ref $CI_COMMIT_REF_NAME -e CI_PIPELINE_ID=$CI_PIPELINE_ID -e \"GITLAB_USER_LOGIN=$GITLAB_USER_LOGIN\" -e \"CI_COMMIT_TITLE=$CI_COMMIT_TITLE\"  > packages/sikahq.com/public/api/version.json", "yarn run static-sikahq.com", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "cp ci/docker/* packages/sikahq.com/", "docker build --platform linux/amd64 -t $CI_REGISTRY_IMAGE/sikahq.com:$CI_COMMIT_SHORT_SHA packages/sikahq.com", "rm packages/sikahq.com/Dockerfile", "rm packages/sikahq.com/nginx-site.conf", "docker push $CI_REGISTRY_IMAGE/sikahq.com:$CI_COMMIT_SHORT_SHA", "docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD", "docker pull $CI_REGISTRY_IMAGE/sikahq.com:$CI_COMMIT_SHORT_SHA", "docker tag $CI_REGISTRY_IMAGE/sikahq.com:$CI_COMMIT_SHORT_SHA $CI_REGISTRY_IMAGE/sikahq.com", "docker push $CI_REGISTRY_IMAGE/sikahq.com"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/sikahq.com/**/*", "yarn.lock"]}, "needs": []}, "validate sikahq.com": {"stage": "docker deploy validate", "script": ["COMMIT=$(curl -fsSL https://sikahq.com/api/version.json | jq -r .git_commit)", "[ $COMMIT == $CI_COMMIT_SHA ]"], "only": {"refs": ["master", "master-ci"], "changes": ["packages/data/**/*", "packages/common/**/*", "packages/course-landing/**/*", "packages/sikahq.com/**/*", "yarn.lock"]}, "needs": ["deploy sikahq.com"]}}